<div class="campaign-details-page">
  <div class="container">
    
    <!-- Loading and error states -->
    @if (isLoading) {
      <div class="loading-state">
        <div class="loading-icon">‚öîÔ∏è</div>
        <p>Preparing your adventure...</p>
      </div>
    }

    @if (error) {
      <div class="error-state">
        <div class="error-icon">üõ°Ô∏è</div>
        <h3>Oops! Something went wrong</h3>
        <p>{{ error }}</p>
      </div>
    }

    <!-- Main content -->
    @if (!isLoading && campaign) {
      <div class="campaign-content">
        
        <!-- Campaign header -->
        <div class="campaign-header">
          <div class="campaign-image-container">
            <img [src]="campaign.imageUrl" [alt]="campaign.title" class="campaign-image">
            <div class="image-overlay"></div>
          </div>
          
          <div class="campaign-info">
            <h1 class="campaign-title">{{ campaign.title }}</h1>
            <p class="campaign-description">{{ campaign.description }}</p>
            
            <div class="campaign-stats">
              <div class="stat-item">
                <span class="stat-label">Level</span>
                <span class="stat-value">{{ campaign.level }}</span>
              </div>
              <div class="stat-item">
                <span class="stat-label">Price</span>
                <span class="stat-value">${{ campaign.price }}</span>
              </div>
              @if (campaign.durationHours) {
                <div class="stat-item">
                  <span class="stat-label">Duration</span>
                  <span class="stat-value">{{ campaign.durationHours }}h</span>
                </div>
              }
              <div class="stat-item">
                <span class="stat-label">Dungeon Master</span>
                <span class="stat-value">{{ campaign.masterName }}</span>
              </div>
            </div>
            
            @if (campaign.tags.length) {
              <div class="campaign-tags">
                <span class="tag" *ngFor="let tag of campaign.tags">{{ tag }}</span>
              </div>
            }
          </div>
        </div>

        <!-- Booking section -->
        <div class="booking-section">
          <h2 class="section-title">BOOK AN ADVENTURE</h2>
          
          <!-- Choose game type -->
          <div class="booking-step">
            <h3 class="step-title">Adventure type</h3>
            <div class="game-type-options">
              <label class="radio-option">
                <input type="radio" name="gameType" value="online" [(ngModel)]="selectedGameType" (change)="onGameTypeChange()">
                <span class="radio-custom"></span>
                <span class="option-text">üåê Online</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="gameType" value="offline" [(ngModel)]="selectedGameType" (change)="onGameTypeChange()">
                <span class="radio-custom"></span>
                <span class="option-text">üè† Offline</span>
              </label>
            </div>
          </div>

          <!-- Choose date -->
          @if (selectedGameType) {
            <div class="booking-step">
              <h3 class="step-title">Select date</h3>
              <div class="input-group">
                <input
                  type="date"
                  class="tavern-input"
                  [min]="getTomorrowDate()"
                  [value]="selectedDate"
                  (change)="onDateChange($event)"
                  [formControl]="bookingForm.controls['date']"
                />
              </div>
            </div>
          }

          <!-- Choose time -->
          @if (selectedDate) {
            <div class="booking-step">
              <h3 class="step-title">Select time</h3>
              
              @if (isLoadingTimeSlots) {
                <div class="loading-slots">
                  <span class="spinner">‚è≥</span>
                  Searching for available slots...
                </div>
              }

              @if (!isLoadingTimeSlots && availableTimeSlots.length > 0) {
                <div class="time-slots">
                  <select
                    class="tavern-select"
                    [formControl]="bookingForm.controls['dateTime']"
                    (change)="onTimeSlotChange($event)"
                  >
                    <option value="">üïê Select time</option>
                    <option
                      *ngFor="let timeSlot of availableTimeSlots"
                      [value]="timeSlot.dateTime"
                      [disabled]="!timeSlot.isAvailable"
                    >
                      {{ timeSlot.dateTime | date:'HH:mm' }} 
                      ({{ timeSlot.maxPlayers - timeSlot.currentPlayers }} spots)
                    </option>
                  </select>
                </div>
              }

              @if (!isLoadingTimeSlots && availableTimeSlots.length === 0) {
                <div class="no-slots">
                  <div class="no-slots-icon">üìÖ</div>
                  <p>No available slots for the selected date</p>
                </div>
              }
            </div>
          }

          <!-- Choose number of players -->
          @if (selectedDateTime) {
            <div class="booking-step">
              <h3 class="step-title">Number of participants</h3>
              <div class="players-selection">
                <input
                  type="number"
                  class="tavern-input players-input"
                  min="1"
                  [max]="getMaxPlayersForTimeSlot()"
                  [(ngModel)]="reservedPlayers"
                  [formControl]="bookingForm.controls['players']"
                  placeholder="1"
                />
                <span class="players-text">out of {{ getMaxPlayersForTimeSlot() }} available</span>
              </div>
              
              <!-- Booking button -->
              <div class="booking-action">
                <button 
                  class="btn btn--primary btn--large"
                  (click)="onReserve()" 
                  [disabled]="!selectedDateTime"
                >
                  ‚öîÔ∏è BOOK AN ADVENTURE
                </button>
              </div>
            </div>
          }
        </div>
        
      </div>
    }
  </div>
</div>